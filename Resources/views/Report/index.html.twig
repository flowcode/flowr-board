{% extends "FlowerCoreBundle::layout.html.twig" %}

{% block title %}{{ '%entity% list'|trans({'%entity%': 'Report'}, 'Report') }} - {{ parent() }}{% endblock %}
{% macro thead(name, field, label) %}
    {% spaceless %}
        {% set sort = app.session.get('sort.' ~ name) %}
        {% if sort and sort.field == field %}
            {% if sort.type == 'DESC' %}
                <a href="{{ path('timelog_sort', {field: field, type: 'ASC'}) }}">{{ label | trans({},'TimeLog')}} <i class="fa fa-sort-down"></i></a>
            {% elseif sort.type == 'ASC' %}
                <a href="{{ path('timelog_sort', {field: field, type: 'DESC'}) }}">{{ label | trans({},'TimeLog')}} <i class="fa fa-sort-up"></i></a>
            {% endif %}
        {% else %}
            <a href="{{ path('timelog_sort', {field: field, type: 'ASC'}) }}">{{ label | trans({},'Report')}} <i class="fa fa-sort"></i></a>
        {% endif %}
    {% endspaceless %}
{% endmacro %}

{% from _self import thead %}


{% block body %}
    <section class="content-header">
        <h1>{{ 'Report' | trans({}, 'Report')}}</h1>
        <ol class="breadcrumb">
            <li><a href={{ path('dashboard') }}><i class="fa fa-dashboard"></i> {{"Dashboard" | trans({}, 'Report')}}</a></li>
            <li class="active" >{{ '%entity% list'|trans({'%entity%': 'Report'}, 'Report') }}</li>
        </ol>
    </section>
    <section class="content">    
        <div class="box">
            <div class="box-header">
                <h3 class="box-title">{{ '%entity% list'|trans({'%entity%': 'Report'}, 'Report') }}</h3>
                <div class="box-tools pull-right">                    <a class="btn btn-default" href={{ path('timelog_new') }}>
                        <i class="fa fa-plus"></i> {{ 'Create a new %entity%'|trans({'%entity%': 'Report'}, 'Report') }}
                    </a>
                            </div>
            <div>
                <h4>{{ 'Total Hours'|trans() }}: {{ totalHours }}
                </h4>
            </div>
            </div>
            <div class="btn-group">
                    <div class="panel-heading">               
                        <button type="button" class="btn btn-default btn-sm filter collapsed" data-toggle="collapse" data-target="#filter">{{'filter' | trans| capitalize  }} <i class="fa fa-filter"></i> </button>
                    </div>
                </div>
                {% set open = "" %}
                {% if addGroupBy |length > 0 %}
                    {% set open = "in" %}
                {% endif %}
                <div id="filter" class="collapse {{open}} row filters-content">
                    <form method="get" action="" class=" form-horizontal">
                        <div id="law_filter" class="col-sm-6" >
                            <div class="form-group">
                                <label class="col-sm-2 control-label " for="addGroupBy">{{'groupBy'| trans({}, 'Task') | capitalize}}</label>

                                <div class="col-sm-8">
                                    {% set multiple = "" %}
                                    {% set icon = "ion-plus-circled" %}
                                    {% if addGroupBy |length > 1 %}
                                        {% set  multiple = "multiple='true'" %}
                                        {% set icon = "ion-ios-minus-outline" %}
                                    {% endif %}
                                    <select id="addGroupBy" name="addGroupBy[]" {{multiple}} class="form-control">
                                        <option value=""></option>
                                        {% for group in groupBy %}
                                            {% set  selected = "" %}
                                            {% if group in addGroupBy %}
                                                {% set  selected = "selected" %}
                                            {% endif %}
                                            <option value="{{group}}" {{selected}}>{{group}}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                
                                <div class="col-sm-1">
                                    <span class="cursor-pointer text-left  ionicons {{icon}}" style="margin-top: 8px;" onclick="toogleSelect(addGroupBy,this)"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label" for="statusFilter">{{'Between Dates' | trans}}</label>
                                <div class="col-sm-4" class="input-group">
                                   <input value="{{startDateFilter}}" placeholder="{{'start' | trans}}" type="text" id="filter_start_date" name="startDateFilter" class="form-control">
                                </div>
                                <div class="col-sm-4" class="input-group">
                                   <input value="{{endDateFilter}}" placeholder="{{'end' | trans}}" type="text" id="filter_end_date" name="endDateFilter" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class=" col-sm-9">
                                    <a class="btn btn-default btn-sm" href="#"><i class="fa fa-times"></i> {{'clean' | trans | capitalize}}</a>
                                    <button class="btn btn-primary btn-sm" type="submit">{{'apply' | trans | capitalize}}</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            <div class="box-body">    
            <table class="table table-striped table-hover table-bordered records_list">
                <thead>
                    <tr>
                        <th scope="col">{{ thead('timelog', 'account', 'Id') }}</th>
                        <th scope="col">{{ thead('timelog', 'project', 'Project') }}</th>
                        <th scope="col">{{ thead('timelog', 'board', 'Account') }}</th>
                        <th scope="col">{{ thead('timelog', 'task_id', 'task_id') }}</th>
                        <th scope="col">{{ thead('timelog', 'task_name', 'task_name') }}</th>
                        <th scope="col">{{ thead('timelog', 'task_created', 'task_created') }}</th>
                        <th scope="col">{{ thead('timelog', 'time_log_hours', 'time_log_hours') }}</th>
                        <th scope="col">{{ thead('timelog', 'time_log_created', 'time_log_created') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for timelog in paginator %}
                        <tr>
                            <td>{{ timelog['account'] }}</td>
                            <td>{{ timelog['project'] }}</td>
                            <td>{{ timelog['board'] }}</td>
                            <td>{{ timelog['task_id'] }}</td>
                            <td>{{ timelog['task_name'] }}</td>
                            <td>{{ timelog['task_created'] }}</td>
                            <td>{{ timelog['time_log_hours'] }}</td>
                            <td>{{ timelog['time_log_created'] }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            </div>
        <div class="box-footer">

        </div>
        
    </section>        

{% endblock %}
{% block javascripts %}
    {{ parent() }}
<script src="{{ asset('bundles/scdatetimepicker/js/bootstrap-datetimepicker.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        function selectAll(parent){
            $(".bulk input.bulk-check").attr("checked",parent.checked);
        }
        function toogleSelect (element, me) {
            var multiple = $(element).attr("multiple");
            if(multiple === undefined){
                $(element).attr("multiple",true);
                $(me).addClass("ion-ios-minus-outline")
                $(me).removeClass("ion-plus-circled")
            }else{
                $(element).removeAttr("multiple");
                $(me).removeClass("ion-ios-minus-outline")
                $(me).addClass("ion-plus-circled")
            }
        }
        $(".bulk-action").click(function () {
            var action = $(this).attr("action");
            var taskIds = [];
            $(".bulk input.bulk-check:checked").each(function () {
                taskIds.push($(this).val());
            });

            $.ajax({
                "url": action,
                "type": "GET",
                "data": {"tasks": taskIds},
                "success": function () {
                    location.reload();
                }
            });

        });
        jQuery(document).ready(function($) {
            $field = $('#filter_start_date');
            $field.datetimepicker({"formatter":"js","format":"dd\/mm\/yy  hh:ii","autoclose":true,"todayBtn":true,"todayHighlight":true,"keyboardNavigation":true});
            $field = $('#filter_end_date');
            $field.datetimepicker({"formatter":"js","format":"dd\/mm\/yy  hh:ii","autoclose":true,"todayBtn":true,"todayHighlight":true,"keyboardNavigation":true});  
        });
    </script>
{% endblock%}